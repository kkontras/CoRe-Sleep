Starting Job
/users/sista/kkontras/Documents/Sleep_Project/main_paper_7.py
/esat/smcdata/users/kkontras/Image_Dataset/no_backup/envs/gl_env/bin/python
Python 3.7.10
/users/sista/kkontras/Documents/Sleep_Project
1
 THE Configuration of your experiment ..
{'agent': 'Sleep_Agent_Init_Train',
 'augmentation': {},
 'channel': 0,
 'dataset': {'cache_datasets': {'test': False, 'train': False, 'valid': False},
             'data_roots': '/esat/biomeddata/SHHS_Dataset/no_backup',
             'data_split': {'split_method': 'patients_test',
                            'test_split_rate': 0.3,
                            'val_split_rate': 0.026},
             'data_view_dir': [{'data_type': 'stft',
                                'list_dir': 'patient_mat_list.txt',
                                'mod': 'eeg',
                                'num_ch': 1},
                               {'data_type': 'stft',
                                'list_dir': 'patient_eog_mat_list.txt',
                                'mod': 'eog',
                                'num_ch': 1}],
             'dataloader_class': 'SleepDataLoader_mat_huy',
             'huy_data': True,
             'inner_overlap': [0.5, 0.5],
             'keep_view': [1, 0],
             'seq_length': [21, 0],
             'seq_views': [False],
             'shuffle_train': True},
 'early_stopping': {'log_interval': 10,
                    'max_epoch': 1000,
                    'n_steps_stop': 250,
                    'n_steps_stop_after': 400,
                    'save_every': 1,
                    'validate_after': 0,
                    'validate_every': 400},
 'exp_name': 'Sleep EEG-EOG BLIP Experiment',
 'lr_finder': False,
 'lr_finder_steps': 100,
 'mode': 'train',
 'model': {'args': {'augment_within': False,
                    'dmodel': 128,
                    'dropout': 0.3,
                    'fc_inner': 1024,
                    'ignore_alignment_val': True,
                    'multi_loss': {'multi_loss_weights': {'alignment_loss': 0,
                                                          'multi_supervised_loss': {'combined': 1,
                                                                                    'eeg': 0,
                                                                                    'eog': 0},
                                                          'order_loss': 0}},
                    'num_classes': 5,
                    'shared_pred': False,
                    'three_modes': True,
                    'training_type': 'alignment_order_multisupervised'},
           'encoders': [{'args': {'align_inner': True,
                                  'd_model': 128,
                                  'dim_feedforward': 1024,
                                  'dim_proj': 128,
                                  'dropout': 0.3,
                                  'inner_biased': False,
                                  'mod_token': True,
                                  'num_heads': 8,
                                  'num_layers': 4,
                                  'outer_biased': False,
                                  'outer_rep': False,
                                  'pos': False,
                                  'rpos': True,
                                  'shared': True,
                                  'skip_random_mod': False},
                         'encoders': [],
                         'freeze_encoder': False,
                         'model': 'SleepEnc_EarlyConcat_3pass_EEG_EOG_free_cliplike',
                         'pretrainedEncoder': {'dir': '', 'use': False},
                         'savetrainedEncoder': {'dir': '', 'save': False}}],
           'load_ongoing': True,
           'model_class': 'EEG_SLEEP_BLIP_GM_MultiMode',
           'pretrained_model': {'dir': '', 'use': False},
           'save_dir': '/esat/smcdata/users/kkontras/Image_Dataset/no_backup/data/2021_data/shhs1/multi_modal/paper_models/fourier_transformer_eeg_eog_mat_BLIP_al01_shared_b16_freetrain_rpos_nopos_nonsharedpreds_Early_nomult_aligninner_trial1_pt.pth.tar'},
 'normalization': {'calculate_metrics': False,
                   'dir': '/esat/biomeddata/SHHS_Dataset/no_backup/metrics_eeg_eog_emg_stft.pkl',
                   'metrics_type': 'train_dataset',
                   'save_metrics': False,
                   'use': True},
 'num_classes': 5,
 'num_modalities': 1,
 'optimizer': {'beta1': 0.9,
               'beta2': 0.999,
               'learning_rate': 0.0001,
               'momentum': 0.2,
               'type': 'Adam',
               'weight_decay': 0.0001},
 'plots': {'plot_stft_num': 0, 'save': False},
 'post_proc': {'post_proc_step': 15,
               'test_postprocessing': False,
               'val_postprocessing': False},
 'scheduler': {'max_lr': 0.03, 'type': 'cosanneal', 'warm_up': 55},
 'statistics': {'ce_weights': {'temp': 0.1, 'use': False}, 'print': False},
 'training_params': {'adversarial_training': {'adv_epsilon': 0.01,
                                              'use': False},
                     'async_loading': True,
                     'batch_size': 16,
                     'cuda': True,
                     'data_loader_workers': 0,
                     'gpu_device': [0],
                     'pin_memory': True,
                     'rec_test': False,
                     'res': True,
                     'seed': 28,
                     'tdqm_disable': True,
                     'test_batch_size': 16,
                     'test_on_tops': True,
                     'use_test_set': True,
                     'validation': True,
                     'verbose': True,
                     'wandb_disable': True}}
 *************************************** 
The experiment name is Sleep EEG-EOG BLIP Experiment
 *************************************** 
stft_eeg Train 3724 validation 100 test 1639
stft_eog Train 3724 validation 100 test 1639
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
We are loading weights
Weights are [0. 0. 0. 0. 0.]
11089
400
28
tensor([0., 0., 0., 0., 0.], device='cuda:0')
We are not shuffling the data
Training function is sleep_train_one_step_alignment_order_multisupervised
Loss Weights are {'combined': 1, 'eeg': 0, 'eog': 0, 'alignments': 0, 'order': 0, 'consistency': 0, 'reconstruction': 0}
We are not shuffling the data
<class 'graphs.models.attention_models.BLIP.SleepEnc_EarlyConcat_3pass_EEG_EOG_free_cliplike'>
Total number of trainable parameters are: 6781711
Available cuda devices: 1, current device:0
Loading from file /esat/smcdata/users/kkontras/Image_Dataset/no_backup/data/2021_data/shhs1/multi_modal/paper_models/fourier_transformer_eeg_eog_mat_BLIP_al01_shared_b16_freetrain_rpos_nopos_nonsharedpreds_Early_nomult_aligninner_trial1_pt.pth.tar
Model has loaded successfully
Metrics have been loaded
Loaded loss weights are: tensor([1., 1., 1., 1., 1.])
[37mThe best in step: 382 so far 
[31mce_loss_combined : 0.282961 [31mce_loss_eeg : 1.531183 [31mce_loss_eog : 1.569435 [31mtotal : 0.282961 [94mAcc_combined: 89.16 [94mAcc_eeg: 42.02 [94mAcc_eog: 39.50 [92mF1_combined: 81.38 [92mF1_eeg: 14.99 [92mF1_eog: 11.41 [92mK_combined: 0.8497 [92mK_eeg: 0.0470 [92mK_eog: 0.0005 [34mF1_perclass_combined: [94.06, 45.73, 89.24, 86.42, 91.43] [34mF1_perclass_eeg: [17.25, 0.0, 57.69, 0.0, 0.0] [34mF1_perclass_eog: [0.06, 0.32, 56.65, 0.0, 0.0] 
Total number of trainable parameters are: 6781711
[37mEpoch 20 step 572 with [31mce_loss_combined : 0.281239 [31mce_loss_eeg : 1.538304 [31mce_loss_eog : 1.569782 [31mtotal : 0.281239 [94mAcc_combined: 89.43 [94mAcc_eeg: 39.56 [94mAcc_eog: 39.51 [92mF1_combined: 81.63 [92mF1_eeg: 11.44 [92mF1_eog: 11.39 [92mK_combined: 0.8535 [92mK_eeg: 0.0013 [92mK_eog: 0.0007 [34mF1_perclass_combined: [94.25, 45.96, 89.49, 86.79, 91.67] [34mF1_perclass_eeg: [0.55, 0.0, 56.66, 0.0, 0.0] [34mF1_perclass_eog: [0.15, 0.11, 56.68, 0.0, 0.0] 
[37mEpoch 20 step 577 with [31mce_loss_combined : 0.281171 [31mce_loss_eeg : 1.537813 [31mce_loss_eog : 1.570010 [31mtotal : 0.281171 [94mAcc_combined: 89.31 [94mAcc_eeg: 39.58 [94mAcc_eog: 39.52 [92mF1_combined: 81.72 [92mF1_eeg: 11.46 [92mF1_eog: 11.40 [92mK_combined: 0.8517 [92mK_eeg: 0.0016 [92mK_eog: 0.0008 [34mF1_perclass_combined: [94.28, 46.88, 89.41, 86.5, 91.52] [34mF1_perclass_eeg: [0.65, 0.0, 56.66, 0.0, 0.0] [34mF1_perclass_eog: [0.2, 0.11, 56.68, 0.0, 0.0] 
[37mEpoch 20 step 578 with [31mce_loss_combined : 0.281031 [31mce_loss_eeg : 1.537835 [31mce_loss_eog : 1.569921 [31mtotal : 0.281031 [94mAcc_combined: 89.34 [94mAcc_eeg: 39.58 [94mAcc_eog: 39.52 [92mF1_combined: 81.71 [92mF1_eeg: 11.47 [92mF1_eog: 11.40 [92mK_combined: 0.8521 [92mK_eeg: 0.0017 [92mK_eog: 0.0008 [34mF1_perclass_combined: [94.26, 46.8, 89.46, 86.43, 91.6] [34mF1_perclass_eeg: [0.67, 0.0, 56.67, 0.0, 0.0] [34mF1_perclass_eog: [0.2, 0.11, 56.68, 0.0, 0.0] 
[37mEpoch 23 step 642 with [31mce_loss_combined : 0.280820 [31mce_loss_eeg : 1.538979 [31mce_loss_eog : 1.573230 [31mtotal : 0.280820 [94mAcc_combined: 89.29 [94mAcc_eeg: 39.53 [94mAcc_eog: 39.55 [92mF1_combined: 81.53 [92mF1_eeg: 11.40 [92mF1_eog: 11.53 [92mK_combined: 0.8517 [92mK_eeg: 0.0008 [92mK_eog: 0.0016 [34mF1_perclass_combined: [94.24, 46.04, 89.36, 86.45, 91.54] [34mF1_perclass_eeg: [0.37, 0.0, 56.65, 0.0, 0.0] [34mF1_perclass_eog: [0.37, 0.59, 56.69, 0.0, 0.0] 
[37mEpoch 23 step 645 with [31mce_loss_combined : 0.280563 [31mce_loss_eeg : 1.542247 [31mce_loss_eog : 1.571640 [31mtotal : 0.280563 [94mAcc_combined: 89.33 [94mAcc_eeg: 39.52 [94mAcc_eog: 39.54 [92mF1_combined: 81.38 [92mF1_eeg: 11.37 [92mF1_eog: 11.47 [92mK_combined: 0.8518 [92mK_eeg: 0.0005 [92mK_eog: 0.0012 [34mF1_perclass_combined: [94.17, 45.22, 89.54, 86.46, 91.5] [34mF1_perclass_eeg: [0.24, 0.0, 56.64, 0.0, 0.0] [34mF1_perclass_eog: [0.34, 0.32, 56.68, 0.0, 0.0] 
[37mEpoch 23 step 654 with [31mce_loss_combined : 0.280370 [31mce_loss_eeg : 1.540460 [31mce_loss_eog : 1.572805 [31mtotal : 0.280370 [94mAcc_combined: 89.34 [94mAcc_eeg: 39.54 [94mAcc_eog: 39.52 [92mF1_combined: 81.45 [92mF1_eeg: 11.40 [92mF1_eog: 11.42 [92mK_combined: 0.8520 [92mK_eeg: 0.0008 [92mK_eog: 0.0008 [34mF1_perclass_combined: [94.34, 45.31, 89.38, 86.58, 91.63] [34mF1_perclass_eeg: [0.35, 0.0, 56.65, 0.0, 0.0] [34mF1_perclass_eog: [0.16, 0.27, 56.68, 0.0, 0.0] 
[37mEpoch 23 step 655 with [31mce_loss_combined : 0.279642 [31mce_loss_eeg : 1.540354 [31mce_loss_eog : 1.572746 [31mtotal : 0.279642 [94mAcc_combined: 89.36 [94mAcc_eeg: 39.54 [94mAcc_eog: 39.52 [92mF1_combined: 81.50 [92mF1_eeg: 11.40 [92mF1_eog: 11.42 [92mK_combined: 0.8522 [92mK_eeg: 0.0008 [92mK_eog: 0.0008 [34mF1_perclass_combined: [94.35, 45.54, 89.46, 86.46, 91.67] [34mF1_perclass_eeg: [0.36, 0.0, 56.65, 0.0, 0.0] [34mF1_perclass_eog: [0.17, 0.27, 56.67, 0.0, 0.0] 
Job finished
