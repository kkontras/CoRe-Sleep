Starting Job
/users/sista/kkontras/Documents/Sleep_Project/main_paper_2.py
/esat/smcdata/users/kkontras/Image_Dataset/no_backup/envs/gl_env/bin/python
Python 3.7.10
/users/sista/kkontras/Documents/Sleep_Project
0
 THE Configuration of your experiment ..
{'agent': 'Sleep_Agent_Init_Train',
 'augmentation': {},
 'channel': 0,
 'dataset': {'cache_datasets': {'test': False, 'train': False, 'valid': False},
             'data_roots': '/esat/biomeddata/SHHS_Dataset/no_backup',
             'data_split': {'split_method': 'patients_test',
                            'test_split_rate': 0.3,
                            'val_split_rate': 0.026},
             'data_view_dir': [{'data_type': 'stft',
                                'list_dir': 'patient_eog_mat_list.txt',
                                'mod': 'eog',
                                'num_ch': 1}],
             'dataloader_class': 'SleepDataLoader_mat_huy',
             'huy_data': True,
             'inner_overlap': [0.5, 0.5],
             'keep_view': [1, 0],
             'seq_length': [21, 0],
             'seq_views': [False],
             'shuffle_train': True},
 'early_stopping': {'log_interval': 10,
                    'max_epoch': 1000,
                    'n_steps_stop': 1000,
                    'n_steps_stop_after': 600,
                    'save_every': 1,
                    'validate_after': 0,
                    'validate_every': 400},
 'exp_name': 'Sleep EEG-EOG BLIP Experiment',
 'lr_finder': False,
 'lr_finder_steps': 100,
 'mode': 'train',
 'model': {'args': {'dmodel': 128, 'fc_inner': 1024, 'num_classes': 5},
           'encoders': [{'args': {'dim_feedforward': 1024,
                                  'dim_proj': 128,
                                  'dmodel': 128,
                                  'inner_biased': False,
                                  'outer_biased': False,
                                  'pos': False,
                                  'rpos': True},
                         'freeze_encoder': False,
                         'model': 'SleepEnc_EOG',
                         'pretrainedEncoder': {'dir': '', 'use': False},
                         'savetrainedEncoder': {'dir': '', 'save': False}}],
           'load_ongoing': False,
           'model_class': 'EEG_SLEEP_BLIP_GM_EEG',
           'pretrained_model': {'dir': '', 'use': False},
           'save_dir': '/esat/smcdata/users/kkontras/Image_Dataset/no_backup/data/2021_data/shhs1/multi_modal/paper_models/fourier_transformer_eog_trial2_pt.pth.tar'},
 'normalization': {'calculate_metrics': False,
                   'dir': '/esat/biomeddata/SHHS_Dataset/no_backup/metrics_eeg_eog_emg_stft.pkl',
                   'metrics_type': 'train_dataset',
                   'save_metrics': False,
                   'use': True},
 'num_classes': 5,
 'num_modalities': 1,
 'optimizer': {'beta1': 0.9,
               'beta2': 0.999,
               'learning_rate': 0.0001,
               'momentum': 0.2,
               'type': 'Adam',
               'weight_decay': 0.0001},
 'plots': {'plot_stft_num': 0, 'save': False},
 'post_proc': {'post_proc_step': 15,
               'test_postprocessing': False,
               'val_postprocessing': False},
 'scheduler': {'max_lr': 0.03, 'type': 'cosanneal', 'warm_up': 55},
 'statistics': {'ce_weights': {'temp': 0.1, 'use': False}, 'print': False},
 'training_params': {'adversarial_training': {'adv_epsilon': 0.01,
                                              'use': False},
                     'async_loading': True,
                     'batch_size': 16,
                     'cuda': True,
                     'data_loader_workers': 6,
                     'gpu_device': [0],
                     'pin_memory': True,
                     'rec_test': False,
                     'res': True,
                     'seed': 35,
                     'tdqm_disable': True,
                     'test_batch_size': 16,
                     'test_on_tops': True,
                     'use_test_set': True,
                     'validation': True,
                     'verbose': True,
                     'wandb_disable': True}}
 *************************************** 
The experiment name is Sleep EEG-EOG BLIP Experiment
 *************************************** 
stft_eog Train 3724 validation 100 test 1639
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
Loading metrics from /esat/biomeddata/SHHS_Dataset/no_backup/metrics_eeg_eog_emg_stft.pkl
Weights are [1. 1. 1. 1. 1.]
11074
400
28
tensor([1., 1., 1., 1., 1.], device='cuda:0')
We are not shuffling the data
Training function is sleep_train_one_step
Loss Weights are {'total': 1}
We are not shuffling the data
<class 'graphs.models.attention_models.windowFeature_base.SleepEnc_EOG'>
Total number of trainable parameters are: 3851397
Available cuda devices: 1, current device:0
Total number of trainable parameters are: 3851397
[37mEpoch 0 step 1 with [31mtotal : 0.897999 [94mAcc_combined: 65.89 [92mF1_combined: 51.32 [92mK_combined: 0.5133 [34mF1_perclass_combined: [72.62, 0.0, 69.76, 59.49, 54.7] 
[37mEpoch 0 step 2 with [31mtotal : 0.715008 [94mAcc_combined: 73.55 [92mF1_combined: 59.35 [92mK_combined: 0.6303 [34mF1_perclass_combined: [78.8, 0.0, 74.48, 69.67, 73.82] 
[37mEpoch 0 step 4 with [31mtotal : 0.657587 [94mAcc_combined: 75.85 [92mF1_combined: 61.48 [92mK_combined: 0.6643 [34mF1_perclass_combined: [81.35, 0.0, 76.13, 71.74, 78.19] 
[37mEpoch 0 step 5 with [31mtotal : 0.623267 [94mAcc_combined: 78.05 [92mF1_combined: 62.88 [92mK_combined: 0.6865 [34mF1_perclass_combined: [83.89, 0.0, 79.62, 71.25, 79.61] 
[37mEpoch 0 step 9 with [31mtotal : 0.620269 [94mAcc_combined: 77.74 [92mF1_combined: 62.07 [92mK_combined: 0.6769 [34mF1_perclass_combined: [82.98, 0.0, 80.02, 65.81, 81.54] 
[37mEpoch 0 step 11 with [31mtotal : 0.557035 [94mAcc_combined: 79.49 [92mF1_combined: 65.85 [92mK_combined: 0.7069 [34mF1_perclass_combined: [85.33, 10.18, 81.13, 69.74, 82.86] 
[37mEpoch 0 step 17 with [31mtotal : 0.529658 [94mAcc_combined: 80.08 [92mF1_combined: 66.06 [92mK_combined: 0.7160 [34mF1_perclass_combined: [86.98, 6.6, 80.66, 73.01, 83.06] 
[37mEpoch 1 step 28 with [31mtotal : 0.495297 [94mAcc_combined: 81.57 [92mF1_combined: 67.91 [92mK_combined: 0.7395 [34mF1_perclass_combined: [88.04, 9.04, 81.84, 74.44, 86.2] 
[37mEpoch 1 step 36 with [31mtotal : 0.487666 [94mAcc_combined: 81.95 [92mF1_combined: 70.44 [92mK_combined: 0.7440 [34mF1_perclass_combined: [88.46, 22.45, 82.81, 72.1, 86.37] 
[37mEpoch 1 step 39 with [31mtotal : 0.487235 [94mAcc_combined: 81.88 [92mF1_combined: 68.14 [92mK_combined: 0.7435 [34mF1_perclass_combined: [88.16, 9.05, 82.38, 75.36, 85.74] 
[37mEpoch 1 step 42 with [31mtotal : 0.487013 [94mAcc_combined: 81.61 [92mF1_combined: 70.54 [92mK_combined: 0.7442 [34mF1_perclass_combined: [87.66, 21.59, 81.71, 74.92, 86.8] 
[37mEpoch 1 step 44 with [31mtotal : 0.484747 [94mAcc_combined: 81.58 [92mF1_combined: 70.80 [92mK_combined: 0.7399 [34mF1_perclass_combined: [88.49, 24.47, 82.1, 73.04, 85.89] 
[37mEpoch 1 step 46 with [31mtotal : 0.479741 [94mAcc_combined: 81.95 [92mF1_combined: 70.01 [92mK_combined: 0.7436 [34mF1_perclass_combined: [88.3, 18.19, 82.39, 74.49, 86.67] 
[37mEpoch 2 step 56 with [31mtotal : 0.469686 [94mAcc_combined: 82.39 [92mF1_combined: 68.52 [92mK_combined: 0.7503 [34mF1_perclass_combined: [89.4, 7.65, 82.23, 75.7, 87.61] 
[37mEpoch 2 step 57 with [31mtotal : 0.459225 [94mAcc_combined: 82.76 [92mF1_combined: 70.44 [92mK_combined: 0.7542 [34mF1_perclass_combined: [89.62, 18.78, 83.38, 72.91, 87.54] 
[37mEpoch 2 step 60 with [31mtotal : 0.451070 [94mAcc_combined: 82.95 [92mF1_combined: 71.38 [92mK_combined: 0.7604 [34mF1_perclass_combined: [89.33, 21.62, 83.42, 75.23, 87.29] 
[37mEpoch 2 step 75 with [31mtotal : 0.448777 [94mAcc_combined: 82.98 [92mF1_combined: 72.15 [92mK_combined: 0.7601 [34mF1_perclass_combined: [89.48, 26.1, 83.61, 73.73, 87.81] 
[37mEpoch 3 step 86 with [31mtotal : 0.447939 [94mAcc_combined: 83.03 [92mF1_combined: 73.10 [92mK_combined: 0.7628 [34mF1_perclass_combined: [89.64, 28.83, 83.07, 76.04, 87.93] 
[37mEpoch 3 step 89 with [31mtotal : 0.444363 [94mAcc_combined: 83.20 [92mF1_combined: 71.75 [92mK_combined: 0.7622 [34mF1_perclass_combined: [89.76, 22.62, 83.65, 74.98, 87.73] 
[37mEpoch 3 step 90 with [31mtotal : 0.442301 [94mAcc_combined: 83.28 [92mF1_combined: 71.95 [92mK_combined: 0.7651 [34mF1_perclass_combined: [89.54, 22.64, 83.59, 75.87, 88.13] 
[37mEpoch 3 step 94 with [31mtotal : 0.440298 [94mAcc_combined: 83.35 [92mF1_combined: 72.42 [92mK_combined: 0.7657 [34mF1_perclass_combined: [90.01, 24.56, 83.59, 75.86, 88.11] 
[37mEpoch 3 step 95 with [31mtotal : 0.439404 [94mAcc_combined: 83.35 [92mF1_combined: 72.53 [92mK_combined: 0.7657 [34mF1_perclass_combined: [89.75, 25.76, 83.79, 75.3, 88.07] 
[37mEpoch 4 step 125 with [31mtotal : 0.435540 [94mAcc_combined: 83.48 [92mF1_combined: 72.80 [92mK_combined: 0.7671 [34mF1_perclass_combined: [90.11, 26.89, 84.0, 74.89, 88.08] 
[37mEpoch 4 step 136 with [31mtotal : 0.434653 [94mAcc_combined: 83.55 [92mF1_combined: 73.03 [92mK_combined: 0.7678 [34mF1_perclass_combined: [90.21, 28.45, 84.16, 73.98, 88.34] 
[37mEpoch 7 step 194 with [31mtotal : 0.433201 [94mAcc_combined: 83.39 [92mF1_combined: 73.03 [92mK_combined: 0.7664 [34mF1_perclass_combined: [90.45, 27.64, 83.54, 75.16, 88.36] 
[37mEpoch 7 step 195 with [31mtotal : 0.427864 [94mAcc_combined: 83.82 [92mF1_combined: 73.46 [92mK_combined: 0.7718 [34mF1_perclass_combined: [90.59, 29.04, 84.2, 74.73, 88.74] 
[37mEpoch 7 step 196 with [31mtotal : 0.424192 [94mAcc_combined: 83.88 [92mF1_combined: 73.89 [92mK_combined: 0.7733 [34mF1_perclass_combined: [90.58, 30.91, 84.28, 75.01, 88.69] 
[37mEpoch 7 step 199 with [31mtotal : 0.423682 [94mAcc_combined: 83.88 [92mF1_combined: 73.82 [92mK_combined: 0.7736 [34mF1_perclass_combined: [90.66, 30.69, 84.37, 75.14, 88.24] 
[37mEpoch 7 step 208 with [31mtotal : 0.423142 [94mAcc_combined: 83.78 [92mF1_combined: 72.72 [92mK_combined: 0.7717 [34mF1_perclass_combined: [90.38, 25.22, 84.23, 75.46, 88.32] 
[37mEpoch 12 step 335 with [31mtotal : 0.418867 [94mAcc_combined: 83.99 [92mF1_combined: 73.80 [92mK_combined: 0.7742 [34mF1_perclass_combined: [90.72, 30.78, 84.6, 74.2, 88.69] 
[37mEpoch 13 step 362 with [31mtotal : 0.418654 [94mAcc_combined: 84.09 [92mF1_combined: 74.51 [92mK_combined: 0.7768 [34mF1_perclass_combined: [90.89, 33.21, 84.53, 75.24, 88.71] 
[37mEpoch 13 step 363 with [31mtotal : 0.418004 [94mAcc_combined: 84.07 [92mF1_combined: 74.31 [92mK_combined: 0.7760 [34mF1_perclass_combined: [90.88, 32.58, 84.57, 74.83, 88.7] 
[37mEpoch 13 step 364 with [31mtotal : 0.417474 [94mAcc_combined: 84.11 [92mF1_combined: 74.28 [92mK_combined: 0.7768 [34mF1_perclass_combined: [90.92, 31.97, 84.55, 75.27, 88.7] 
[37mEpoch 22 step 612 with [31mtotal : 0.416811 [94mAcc_combined: 84.35 [92mF1_combined: 74.60 [92mK_combined: 0.7801 [34mF1_perclass_combined: [91.24, 32.6, 84.77, 75.52, 88.87] 
[37mEpoch 23 step 641 with [31mtotal : 0.415812 [94mAcc_combined: 84.39 [92mF1_combined: 75.11 [92mK_combined: 0.7813 [34mF1_perclass_combined: [91.14, 35.08, 84.8, 75.67, 88.84] 
[37mEpoch 24 step 668 with [31mtotal : 0.414544 [94mAcc_combined: 84.42 [92mF1_combined: 75.02 [92mK_combined: 0.7811 [34mF1_perclass_combined: [91.26, 34.73, 84.88, 75.2, 89.03] 
