Starting Job
/users/sista/kkontras/Documents/Sleep_Project/main_paper_9.py
/esat/smcdata/users/kkontras/Image_Dataset/no_backup/envs/gl_env/bin/python
Python 3.7.10
/users/sista/kkontras/Documents/Sleep_Project
1
 THE Configuration of your experiment ..
{'agent': 'Sleep_Agent_Init_Train',
 'augmentation': {},
 'channel': 0,
 'dataset': {'cache_datasets': {'test': False, 'train': False, 'valid': False},
             'data_roots': '/esat/biomeddata/SHHS_Dataset/no_backup',
             'data_split': {'fold': 0,
                            'fold_size': 7,
                            'folds_file': '/users/sista/kkontras/Documents/Huy_shhs1/HUY '
                                          'SHHS1 CODE/data_split_eval.mat',
                            'rand_split': 0,
                            'rand_splits': 13,
                            'split_method': 'patients_huy',
                            'test_split_rate': 0.3,
                            'val_patient_num': 3,
                            'val_split_rate': 0.01692},
             'data_view_dir': [{'data_type': 'stft',
                                'list_dir': 'patient_mat_list.txt',
                                'mod': 'eeg',
                                'num_ch': 1}],
             'dataloader_class': 'SleepDataLoader_mat_huy',
             'huy_data': True,
             'inner_overlap': [0.5, 0.5],
             'keep_view': [1, 0],
             'seq_length': [21, 0],
             'seq_views': [False],
             'shuffle_train': True},
 'early_stopping': {'log_interval': 10,
                    'max_epoch': 1000,
                    'n_steps_stop': 1000,
                    'n_steps_stop_after': 600,
                    'save_every': 1,
                    'validate_after': 0,
                    'validate_every': 400},
 'exp_name': 'Sleep EEG-EOG BLIP Experiment',
 'lr_finder': False,
 'lr_finder_steps': 100,
 'mode': 'train',
 'model': {'args': {'dmodel': 128,
                    'dropout': 0.3,
                    'fc_inner': 1024,
                    'num_classes': 5},
           'encoders': [{'args': {'dim_feedforward': 1024,
                                  'dim_proj': 128,
                                  'dmodel': 128,
                                  'dropout': 0.3,
                                  'inner_biased': False,
                                  'outer_biased': False,
                                  'pos': False,
                                  'rpos': True},
                         'freeze_encoder': False,
                         'model': 'SleepEnc_EEG',
                         'pretrainedEncoder': {'dir': '', 'use': False},
                         'savetrainedEncoder': {'dir': '', 'save': False}}],
           'load_ongoing': False,
           'model_class': 'EEG_SLEEP_BLIP_GM_EEG',
           'pretrained_model': {'dir': '', 'use': False},
           'save_dir': '/esat/smcdata/users/kkontras/Image_Dataset/no_backup/data/2021_data/shhs1/multi_modal/paper_models/fourier_transformer_eeg_drop03_trial1.pth.tar'},
 'normalization': {'calculate_metrics': False,
                   'dir': '/esat/biomeddata/SHHS_Dataset/no_backup/metrics_eeg_eog_emg_stft.pkl',
                   'metrics_type': 'train_dataset',
                   'save_metrics': False,
                   'use': True},
 'num_classes': 5,
 'num_modalities': 1,
 'optimizer': {'beta1': 0.9,
               'beta2': 0.999,
               'learning_rate': 0.0001,
               'momentum': 0.2,
               'type': 'Adam',
               'weight_decay': 0.0001},
 'plots': {'plot_stft_num': 0, 'save': False},
 'post_proc': {'post_proc_step': 15,
               'test_postprocessing': False,
               'val_postprocessing': False},
 'scheduler': {'max_lr': 0.03, 'type': 'cosanneal', 'warm_up': 55},
 'statistics': {'ce_weights': {'temp': 0.1, 'use': False}, 'print': False},
 'training_params': {'adversarial_training': {'adv_epsilon': 0.01,
                                              'use': False},
                     'async_loading': True,
                     'batch_size': 16,
                     'cuda': True,
                     'data_loader_workers': 6,
                     'gpu_device': [0],
                     'pin_memory': True,
                     'rec_test': False,
                     'res': True,
                     'seed': 28,
                     'tdqm_disable': True,
                     'test_batch_size': 16,
                     'test_on_tops': True,
                     'use_test_set': True,
                     'validation': True,
                     'verbose': True,
                     'wandb_disable': True}}
 *************************************** 
The experiment name is Sleep EEG-EOG BLIP Experiment
 *************************************** 
We are splitting dataset by huy splits
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
Loading metrics from /esat/biomeddata/SHHS_Dataset/no_backup/metrics_eeg_eog_emg_stft.pkl
Weights are [1. 1. 1. 1. 1.]
11070
400
28
tensor([1., 1., 1., 1., 1.], device='cuda:0')
We are not shuffling the data
Training function is sleep_train_one_step
Loss Weights are {'total': 1}
We are not shuffling the data
<class 'graphs.models.attention_models.windowFeature_base.SleepEnc_EEG'>
Total number of trainable parameters are: 3851397
Available cuda devices: 1, current device:0
Total number of trainable parameters are: 3851397
[37mEpoch 0 step 1 with [31mtotal : 0.882042 [94mAcc_combined: 67.00 [92mF1_combined: 50.66 [92mK_combined: 0.5390 [34mF1_perclass_combined: [82.33, 0.0, 65.2, 69.33, 36.45] 
[37mEpoch 0 step 2 with [31mtotal : 0.717841 [94mAcc_combined: 75.89 [92mF1_combined: 60.00 [92mK_combined: 0.6600 [34mF1_perclass_combined: [85.71, 0.11, 76.32, 79.26, 58.59] 
[37mEpoch 0 step 3 with [31mtotal : 0.668634 [94mAcc_combined: 76.20 [92mF1_combined: 61.47 [92mK_combined: 0.6644 [34mF1_perclass_combined: [85.47, 8.18, 76.53, 80.07, 57.12] 
[37mEpoch 0 step 4 with [31mtotal : 0.615223 [94mAcc_combined: 77.89 [92mF1_combined: 64.48 [92mK_combined: 0.6927 [34mF1_perclass_combined: [86.97, 10.56, 77.47, 80.67, 66.74] 
[37mEpoch 0 step 9 with [31mtotal : 0.560464 [94mAcc_combined: 80.25 [92mF1_combined: 69.41 [92mK_combined: 0.7298 [34mF1_perclass_combined: [87.76, 23.34, 79.58, 83.26, 73.09] 
[37mEpoch 0 step 11 with [31mtotal : 0.547518 [94mAcc_combined: 80.70 [92mF1_combined: 70.32 [92mK_combined: 0.7292 [34mF1_perclass_combined: [88.66, 30.68, 81.83, 73.58, 76.87] 
[37mEpoch 0 step 13 with [31mtotal : 0.521450 [94mAcc_combined: 82.85 [92mF1_combined: 69.08 [92mK_combined: 0.7596 [34mF1_perclass_combined: [88.89, 11.22, 83.73, 83.89, 77.66] 
[37mEpoch 0 step 14 with [31mtotal : 0.474583 [94mAcc_combined: 83.60 [92mF1_combined: 74.52 [92mK_combined: 0.7718 [34mF1_perclass_combined: [88.87, 36.12, 84.58, 83.93, 79.09] 
