Starting Job
/users/sista/kkontras/Documents/Sleep_Project/main_paper_9.py
/esat/smcdata/users/kkontras/Image_Dataset/no_backup/envs/gl_env/bin/python
Python 3.7.10
/users/sista/kkontras/Documents/Sleep_Project
0
 THE Configuration of your experiment ..
{'agent': 'Sleep_Agent_Init_Train',
 'augmentation': {},
 'channel': 0,
 'dataset': {'cache_datasets': {'test': False, 'train': False, 'valid': False},
             'data_roots': '/esat/biomeddata/SHHS_Dataset/no_backup',
             'data_split': {'fold': 0,
                            'fold_size': 7,
                            'folds_file': '/users/sista/kkontras/Documents/Huy_shhs1/HUY '
                                          'SHHS1 CODE/data_split_eval.mat',
                            'rand_split': 0,
                            'rand_splits': 13,
                            'split_method': 'patients_huy',
                            'test_split_rate': 0.3,
                            'val_patient_num': 3,
                            'val_split_rate': 0.01692},
             'data_view_dir': [{'data_type': 'stft',
                                'list_dir': 'patient_mat_list.txt',
                                'mod': 'eeg',
                                'num_ch': 1}],
             'dataloader_class': 'SleepDataLoader_mat_huy',
             'huy_data': True,
             'inner_overlap': [0.5, 0.5],
             'keep_view': [1, 0],
             'seq_length': [21, 0],
             'seq_views': [False],
             'shuffle_train': True},
 'early_stopping': {'log_interval': 10,
                    'max_epoch': 1000,
                    'n_steps_stop': 1000,
                    'n_steps_stop_after': 600,
                    'save_every': 1,
                    'validate_after': 0,
                    'validate_every': 400},
 'exp_name': 'Sleep EEG-EOG BLIP Experiment',
 'lr_finder': False,
 'lr_finder_steps': 100,
 'mode': 'train',
 'model': {'args': {'dmodel': 128,
                    'dropout': 0.3,
                    'fc_inner': 1024,
                    'num_classes': 5},
           'encoders': [{'args': {'dim_feedforward': 1024,
                                  'dim_proj': 128,
                                  'dmodel': 128,
                                  'dropout': 0.3,
                                  'inner_biased': False,
                                  'outer_biased': False,
                                  'pos': False,
                                  'rpos': True},
                         'freeze_encoder': False,
                         'model': 'SleepEnc_EEG',
                         'pretrainedEncoder': {'dir': '', 'use': False},
                         'savetrainedEncoder': {'dir': '', 'save': False}}],
           'load_ongoing': True,
           'model_class': 'EEG_SLEEP_BLIP_GM_EEG',
           'pretrained_model': {'dir': '', 'use': False},
           'save_dir': '/esat/smcdata/users/kkontras/Image_Dataset/no_backup/data/2021_data/shhs1/multi_modal/paper_models/fourier_transformer_eeg_drop03_trial1.pth.tar'},
 'normalization': {'calculate_metrics': False,
                   'dir': '/esat/biomeddata/SHHS_Dataset/no_backup/metrics_eeg_eog_emg_stft.pkl',
                   'metrics_type': 'train_dataset',
                   'save_metrics': False,
                   'use': True},
 'num_classes': 5,
 'num_modalities': 1,
 'optimizer': {'beta1': 0.9,
               'beta2': 0.999,
               'learning_rate': 0.0001,
               'momentum': 0.2,
               'type': 'Adam',
               'weight_decay': 0.0001},
 'plots': {'plot_stft_num': 0, 'save': False},
 'post_proc': {'post_proc_step': 15,
               'test_postprocessing': False,
               'val_postprocessing': False},
 'scheduler': {'max_lr': 0.03, 'type': 'cosanneal', 'warm_up': 55},
 'statistics': {'ce_weights': {'temp': 0.1, 'use': False}, 'print': False},
 'training_params': {'adversarial_training': {'adv_epsilon': 0.01,
                                              'use': False},
                     'async_loading': True,
                     'batch_size': 16,
                     'cuda': True,
                     'data_loader_workers': 6,
                     'gpu_device': [0],
                     'pin_memory': True,
                     'rec_test': False,
                     'res': True,
                     'seed': 28,
                     'tdqm_disable': True,
                     'test_batch_size': 16,
                     'test_on_tops': True,
                     'use_test_set': True,
                     'validation': True,
                     'verbose': True,
                     'wandb_disable': True}}
 *************************************** 
The experiment name is Sleep EEG-EOG BLIP Experiment
 *************************************** 
We are splitting dataset by huy splits
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
We are loading weights
Weights are [0. 0. 0. 0. 0.]
11070
400
28
tensor([0., 0., 0., 0., 0.], device='cuda:0')
We are not shuffling the data
Training function is sleep_train_one_step
Loss Weights are {'total': 1}
We are not shuffling the data
<class 'graphs.models.attention_models.windowFeature_base.SleepEnc_EEG'>
Total number of trainable parameters are: 3851397
Available cuda devices: 1, current device:0
Loading from file /esat/smcdata/users/kkontras/Image_Dataset/no_backup/data/2021_data/shhs1/multi_modal/paper_models/fourier_transformer_eeg_drop03_trial1.pth.tar
Model has loaded successfully
Metrics have been loaded
Loaded loss weights are: tensor([1., 1., 1., 1., 1.])
[37mThe best in step: 136 so far 
[31mtotal : 0.358284 [94mAcc_combined: 87.45 [92mF1_combined: 80.01 [92mK_combined: 0.8256 [34mF1_perclass_combined: [91.99, 46.69, 87.85, 86.47, 87.04] 
Total number of trainable parameters are: 3851397
[37mEpoch 8 step 240 with [31mtotal : 0.355271 [94mAcc_combined: 87.34 [92mF1_combined: 79.33 [92mK_combined: 0.8242 [34mF1_perclass_combined: [91.98, 43.54, 87.57, 86.44, 87.14] 
[37mEpoch 8 step 244 with [31mtotal : 0.355097 [94mAcc_combined: 87.38 [92mF1_combined: 79.45 [92mK_combined: 0.8244 [34mF1_perclass_combined: [91.97, 44.11, 87.7, 86.37, 87.09] 
[37mEpoch 9 step 275 with [31mtotal : 0.354604 [94mAcc_combined: 87.46 [92mF1_combined: 79.22 [92mK_combined: 0.8253 [34mF1_perclass_combined: [92.04, 42.68, 87.9, 86.51, 86.96] 
[37mEpoch 9 step 279 with [31mtotal : 0.353031 [94mAcc_combined: 87.53 [92mF1_combined: 80.17 [92mK_combined: 0.8273 [34mF1_perclass_combined: [92.02, 47.01, 87.85, 86.78, 87.18] 
[37mEpoch 9 step 280 with [31mtotal : 0.352101 [94mAcc_combined: 87.56 [92mF1_combined: 80.26 [92mK_combined: 0.8273 [34mF1_perclass_combined: [91.97, 47.4, 87.99, 86.71, 87.24] 
[37mEpoch 9 step 281 with [31mtotal : 0.349691 [94mAcc_combined: 87.61 [92mF1_combined: 80.25 [92mK_combined: 0.8278 [34mF1_perclass_combined: [92.08, 47.1, 88.04, 86.76, 87.29] 
[37mEpoch 9 step 283 with [31mtotal : 0.349438 [94mAcc_combined: 87.62 [92mF1_combined: 80.18 [92mK_combined: 0.8278 [34mF1_perclass_combined: [92.1, 46.81, 88.07, 86.56, 87.33] 
[37mEpoch 9 step 284 with [31mtotal : 0.349011 [94mAcc_combined: 87.60 [92mF1_combined: 80.20 [92mK_combined: 0.8277 [34mF1_perclass_combined: [92.08, 46.87, 88.0, 86.72, 87.33] 
[37mEpoch 9 step 285 with [31mtotal : 0.348862 [94mAcc_combined: 87.60 [92mF1_combined: 80.23 [92mK_combined: 0.8277 [34mF1_perclass_combined: [92.07, 47.07, 87.97, 86.72, 87.3] 
[37mEpoch 12 step 344 with [31mtotal : 0.345807 [94mAcc_combined: 87.62 [92mF1_combined: 80.07 [92mK_combined: 0.8280 [34mF1_perclass_combined: [92.26, 45.95, 87.82, 86.76, 87.56] 
[37mEpoch 12 step 358 with [31mtotal : 0.345780 [94mAcc_combined: 87.73 [92mF1_combined: 80.03 [92mK_combined: 0.8295 [34mF1_perclass_combined: [92.41, 45.58, 87.98, 86.84, 87.33] 
[37mEpoch 12 step 365 with [31mtotal : 0.345534 [94mAcc_combined: 87.74 [92mF1_combined: 80.33 [92mK_combined: 0.8297 [34mF1_perclass_combined: [92.4, 47.23, 88.06, 86.67, 87.32] 
[37mEpoch 12 step 367 with [31mtotal : 0.345530 [94mAcc_combined: 87.75 [92mF1_combined: 80.33 [92mK_combined: 0.8298 [34mF1_perclass_combined: [92.4, 47.16, 88.08, 86.68, 87.32] 
[37mEpoch 17 step 505 with [31mtotal : 0.345111 [94mAcc_combined: 87.80 [92mF1_combined: 80.29 [92mK_combined: 0.8303 [34mF1_perclass_combined: [92.45, 46.83, 88.19, 86.81, 87.19] 
[37mEpoch 18 step 510 with [31mtotal : 0.343667 [94mAcc_combined: 87.84 [92mF1_combined: 80.33 [92mK_combined: 0.8308 [34mF1_perclass_combined: [92.57, 46.77, 88.16, 86.85, 87.28] 
[37mEpoch 18 step 511 with [31mtotal : 0.343297 [94mAcc_combined: 87.85 [92mF1_combined: 80.47 [92mK_combined: 0.8311 [34mF1_perclass_combined: [92.54, 47.5, 88.17, 86.84, 87.31] 
[37mEpoch 18 step 512 with [31mtotal : 0.343118 [94mAcc_combined: 87.87 [92mF1_combined: 80.41 [92mK_combined: 0.8314 [34mF1_perclass_combined: [92.53, 47.12, 88.22, 86.86, 87.33] 
