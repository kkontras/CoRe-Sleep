Starting Job
/users/sista/kkontras/Documents/Sleep_Project/main_paper_10.py
/esat/smcdata/users/kkontras/Image_Dataset/no_backup/envs/gl_env/bin/python
Python 3.7.10
/users/sista/kkontras/Documents/Sleep_Project
0
 THE Configuration of your experiment ..
{'agent': 'Sleep_Agent_Init_Train',
 'augmentation': {},
 'channel': 0,
 'dataset': {'cache_datasets': {'test': False, 'train': False, 'valid': False},
             'data_roots': '/esat/biomeddata/SHHS_Dataset/no_backup',
             'data_split': {'split_method': 'patients_test',
                            'test_split_rate': 0.3,
                            'val_split_rate': 0.026},
             'data_view_dir': [{'data_type': 'stft',
                                'list_dir': 'patient_mat_list.txt',
                                'mod': 'eeg',
                                'num_ch': 1}],
             'dataloader_class': 'SleepDataLoader_mat_huy',
             'huy_data': True,
             'inner_overlap': [0.5, 0.5],
             'keep_view': [1, 0],
             'seq_length': [21, 0],
             'seq_views': [False],
             'shuffle_train': True},
 'early_stopping': {'log_interval': 10,
                    'max_epoch': 1000,
                    'n_steps_stop': 1000,
                    'n_steps_stop_after': 600,
                    'save_every': 1,
                    'validate_after': 0,
                    'validate_every': 400},
 'exp_name': 'Sleep EEG-EOG BLIP Experiment',
 'lr_finder': False,
 'lr_finder_steps': 100,
 'mode': 'train',
 'model': {'args': {'dmodel': 128,
                    'dropout': 0.3,
                    'fc_inner': 1024,
                    'num_classes': 5},
           'encoders': [{'args': {'dim_feedforward': 1024,
                                  'dim_proj': 128,
                                  'dmodel': 128,
                                  'dropout': 0.3,
                                  'inner_biased': False,
                                  'outer_biased': False,
                                  'pos': False,
                                  'rpos': True},
                         'freeze_encoder': False,
                         'model': 'SleepEnc_EEG',
                         'pretrainedEncoder': {'dir': '', 'use': False},
                         'savetrainedEncoder': {'dir': '', 'save': False}}],
           'load_ongoing': False,
           'model_class': 'EEG_SLEEP_BLIP_GM_EEG',
           'pretrained_model': {'dir': '', 'use': False},
           'save_dir': '/esat/smcdata/users/kkontras/Image_Dataset/no_backup/data/2021_data/shhs1/multi_modal/paper_models/fourier_transformer_eeg_drop03_trial1_pt.pth.tar'},
 'normalization': {'calculate_metrics': False,
                   'dir': '/esat/biomeddata/SHHS_Dataset/no_backup/metrics_eeg_eog_emg_stft.pkl',
                   'metrics_type': 'train_dataset',
                   'save_metrics': False,
                   'use': True},
 'num_classes': 5,
 'num_modalities': 1,
 'optimizer': {'beta1': 0.9,
               'beta2': 0.999,
               'learning_rate': 0.0001,
               'momentum': 0.2,
               'type': 'Adam',
               'weight_decay': 0.0001},
 'plots': {'plot_stft_num': 0, 'save': False},
 'post_proc': {'post_proc_step': 15,
               'test_postprocessing': False,
               'val_postprocessing': False},
 'scheduler': {'max_lr': 0.03, 'type': 'cosanneal', 'warm_up': 55},
 'statistics': {'ce_weights': {'temp': 0.1, 'use': False}, 'print': False},
 'training_params': {'adversarial_training': {'adv_epsilon': 0.01,
                                              'use': False},
                     'async_loading': True,
                     'batch_size': 16,
                     'cuda': True,
                     'data_loader_workers': 6,
                     'gpu_device': [0],
                     'pin_memory': True,
                     'rec_test': False,
                     'res': True,
                     'seed': 28,
                     'tdqm_disable': True,
                     'test_batch_size': 16,
                     'test_on_tops': True,
                     'use_test_set': True,
                     'validation': True,
                     'verbose': True,
                     'wandb_disable': True}}
 *************************************** 
The experiment name is Sleep EEG-EOG BLIP Experiment
 *************************************** 
stft_eeg Train 3724 validation 100 test 1639
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
{'use_type': False, 'skip_skips': True}
Loading metrics from /esat/biomeddata/SHHS_Dataset/no_backup/metrics_eeg_eog_emg_stft.pkl
Weights are [1. 1. 1. 1. 1.]
11089
400
28
tensor([1., 1., 1., 1., 1.], device='cuda:0')
We are not shuffling the data
Training function is sleep_train_one_step
Loss Weights are {'total': 1}
We are not shuffling the data
<class 'graphs.models.attention_models.windowFeature_base.SleepEnc_EEG'>
Total number of trainable parameters are: 3851397
Available cuda devices: 1, current device:0
Total number of trainable parameters are: 3851397
[37mEpoch 0 step 1 with [31mtotal : 0.926099 [94mAcc_combined: 66.62 [92mF1_combined: 51.06 [92mK_combined: 0.5247 [34mF1_perclass_combined: [75.19, 0.0, 72.9, 45.21, 61.99] 
[37mEpoch 0 step 2 with [31mtotal : 0.715270 [94mAcc_combined: 74.39 [92mF1_combined: 58.21 [92mK_combined: 0.6367 [34mF1_perclass_combined: [82.14, 0.86, 79.01, 69.74, 59.3] 
[37mEpoch 0 step 4 with [31mtotal : 0.656975 [94mAcc_combined: 76.47 [92mF1_combined: 61.59 [92mK_combined: 0.6728 [34mF1_perclass_combined: [85.77, 1.71, 77.36, 75.41, 67.7] 
[37mEpoch 0 step 5 with [31mtotal : 0.541998 [94mAcc_combined: 80.94 [92mF1_combined: 69.10 [92mK_combined: 0.7369 [34mF1_perclass_combined: [87.52, 17.99, 81.71, 83.1, 75.18] 
[37mEpoch 0 step 8 with [31mtotal : 0.533301 [94mAcc_combined: 81.98 [92mF1_combined: 70.55 [92mK_combined: 0.7510 [34mF1_perclass_combined: [87.81, 21.73, 82.89, 83.19, 77.13] 
[37mEpoch 0 step 9 with [31mtotal : 0.518769 [94mAcc_combined: 82.28 [92mF1_combined: 69.98 [92mK_combined: 0.7512 [34mF1_perclass_combined: [87.97, 18.74, 83.35, 83.75, 76.09] 
[37mEpoch 0 step 10 with [31mtotal : 0.482678 [94mAcc_combined: 83.16 [92mF1_combined: 73.35 [92mK_combined: 0.7653 [34mF1_perclass_combined: [88.44, 29.96, 84.11, 83.89, 80.33] 
[37mEpoch 0 step 19 with [31mtotal : 0.469218 [94mAcc_combined: 83.62 [92mF1_combined: 73.94 [92mK_combined: 0.7760 [34mF1_perclass_combined: [89.67, 31.16, 83.6, 83.21, 82.04] 
[37mEpoch 0 step 22 with [31mtotal : 0.449363 [94mAcc_combined: 84.96 [92mF1_combined: 76.75 [92mK_combined: 0.7923 [34mF1_perclass_combined: [89.8, 40.16, 85.66, 84.94, 83.18] 
[37mEpoch 0 step 25 with [31mtotal : 0.436176 [94mAcc_combined: 84.42 [92mF1_combined: 73.79 [92mK_combined: 0.7846 [34mF1_perclass_combined: [88.38, 27.13, 85.27, 84.38, 83.8] 
[37mEpoch 0 step 26 with [31mtotal : 0.429438 [94mAcc_combined: 84.77 [92mF1_combined: 75.80 [92mK_combined: 0.7882 [34mF1_perclass_combined: [89.93, 36.6, 85.23, 84.83, 82.4] 
[37mEpoch 1 step 30 with [31mtotal : 0.418295 [94mAcc_combined: 85.11 [92mF1_combined: 77.28 [92mK_combined: 0.7952 [34mF1_perclass_combined: [89.81, 41.44, 85.43, 84.88, 84.86] 
[37mEpoch 1 step 32 with [31mtotal : 0.418107 [94mAcc_combined: 84.69 [92mF1_combined: 75.33 [92mK_combined: 0.7865 [34mF1_perclass_combined: [89.25, 35.16, 85.88, 81.58, 84.78] 
[37mEpoch 1 step 39 with [31mtotal : 0.408426 [94mAcc_combined: 85.38 [92mF1_combined: 74.24 [92mK_combined: 0.7965 [34mF1_perclass_combined: [89.0, 25.79, 86.49, 84.91, 85.01] 
[37mEpoch 1 step 46 with [31mtotal : 0.397812 [94mAcc_combined: 86.30 [92mF1_combined: 78.40 [92mK_combined: 0.8107 [34mF1_perclass_combined: [90.54, 42.62, 86.96, 85.27, 86.6] 
[37mEpoch 2 step 57 with [31mtotal : 0.391395 [94mAcc_combined: 86.11 [92mF1_combined: 77.35 [92mK_combined: 0.8071 [34mF1_perclass_combined: [90.39, 38.21, 86.74, 85.39, 86.03] 
[37mEpoch 2 step 58 with [31mtotal : 0.385773 [94mAcc_combined: 86.51 [92mF1_combined: 78.59 [92mK_combined: 0.8143 [34mF1_perclass_combined: [90.8, 42.57, 86.89, 85.51, 87.19] 
[37mEpoch 2 step 59 with [31mtotal : 0.378591 [94mAcc_combined: 86.24 [92mF1_combined: 79.37 [92mK_combined: 0.8110 [34mF1_perclass_combined: [90.81, 47.03, 86.69, 85.35, 86.95] 
[37mEpoch 2 step 60 with [31mtotal : 0.368417 [94mAcc_combined: 86.55 [92mF1_combined: 78.77 [92mK_combined: 0.8142 [34mF1_perclass_combined: [90.98, 43.25, 86.86, 85.54, 87.21] 
[37mEpoch 2 step 64 with [31mtotal : 0.367390 [94mAcc_combined: 86.96 [92mF1_combined: 79.18 [92mK_combined: 0.8196 [34mF1_perclass_combined: [91.11, 43.76, 87.35, 85.64, 88.05] 
[37mEpoch 2 step 73 with [31mtotal : 0.365549 [94mAcc_combined: 86.74 [92mF1_combined: 79.11 [92mK_combined: 0.8174 [34mF1_perclass_combined: [90.77, 44.19, 87.14, 86.0, 87.47] 
[37mEpoch 2 step 74 with [31mtotal : 0.364244 [94mAcc_combined: 86.86 [92mF1_combined: 79.28 [92mK_combined: 0.8189 [34mF1_perclass_combined: [90.98, 44.64, 87.2, 85.74, 87.84] 
[37mEpoch 2 step 75 with [31mtotal : 0.358702 [94mAcc_combined: 86.99 [92mF1_combined: 79.63 [92mK_combined: 0.8206 [34mF1_perclass_combined: [91.15, 45.73, 87.33, 85.96, 87.97] 
[37mEpoch 3 step 89 with [31mtotal : 0.354433 [94mAcc_combined: 87.05 [92mF1_combined: 79.07 [92mK_combined: 0.8202 [34mF1_perclass_combined: [91.26, 43.15, 87.54, 85.4, 88.0] 
[37mEpoch 3 step 94 with [31mtotal : 0.353925 [94mAcc_combined: 87.01 [92mF1_combined: 78.67 [92mK_combined: 0.8201 [34mF1_perclass_combined: [91.22, 40.69, 87.25, 85.88, 88.3] 
[37mEpoch 3 step 95 with [31mtotal : 0.352263 [94mAcc_combined: 87.07 [92mF1_combined: 78.86 [92mK_combined: 0.8210 [34mF1_perclass_combined: [91.18, 41.56, 87.37, 85.86, 88.34] 
[37mEpoch 4 step 125 with [31mtotal : 0.351487 [94mAcc_combined: 87.07 [92mF1_combined: 79.05 [92mK_combined: 0.8215 [34mF1_perclass_combined: [91.3, 42.64, 87.37, 85.89, 88.03] 
[37mEpoch 4 step 127 with [31mtotal : 0.350936 [94mAcc_combined: 87.11 [92mF1_combined: 78.52 [92mK_combined: 0.8208 [34mF1_perclass_combined: [91.33, 40.22, 87.58, 85.2, 88.29] 
[37mEpoch 4 step 128 with [31mtotal : 0.342863 [94mAcc_combined: 87.51 [92mF1_combined: 79.67 [92mK_combined: 0.8270 [34mF1_perclass_combined: [91.69, 44.15, 87.86, 86.02, 88.66] 
[37mEpoch 7 step 197 with [31mtotal : 0.341392 [94mAcc_combined: 87.65 [92mF1_combined: 80.53 [92mK_combined: 0.8289 [34mF1_perclass_combined: [92.19, 47.95, 87.98, 85.75, 88.75] 
[37mEpoch 7 step 198 with [31mtotal : 0.340319 [94mAcc_combined: 87.67 [92mF1_combined: 79.68 [92mK_combined: 0.8291 [34mF1_perclass_combined: [92.08, 43.6, 87.99, 85.76, 88.94] 
[37mEpoch 7 step 205 with [31mtotal : 0.339048 [94mAcc_combined: 87.66 [92mF1_combined: 79.76 [92mK_combined: 0.8290 [34mF1_perclass_combined: [92.21, 43.83, 87.78, 86.04, 88.92] 
[37mEpoch 7 step 207 with [31mtotal : 0.338983 [94mAcc_combined: 87.67 [92mF1_combined: 79.87 [92mK_combined: 0.8295 [34mF1_perclass_combined: [92.06, 44.39, 87.9, 86.3, 88.68] 
[37mEpoch 7 step 208 with [31mtotal : 0.338787 [94mAcc_combined: 87.66 [92mF1_combined: 79.83 [92mK_combined: 0.8292 [34mF1_perclass_combined: [92.07, 44.45, 87.94, 86.0, 88.7] 
[37mEpoch 7 step 210 with [31mtotal : 0.336879 [94mAcc_combined: 87.71 [92mF1_combined: 79.75 [92mK_combined: 0.8295 [34mF1_perclass_combined: [92.08, 43.74, 87.99, 85.99, 88.94] 
[37mEpoch 7 step 211 with [31mtotal : 0.336212 [94mAcc_combined: 87.70 [92mF1_combined: 79.82 [92mK_combined: 0.8293 [34mF1_perclass_combined: [92.01, 44.31, 88.06, 85.81, 88.92] 
[37mEpoch 11 step 329 with [31mtotal : 0.335777 [94mAcc_combined: 87.77 [92mF1_combined: 80.04 [92mK_combined: 0.8302 [34mF1_perclass_combined: [92.11, 45.03, 88.16, 86.12, 88.8] 
[37mEpoch 12 step 336 with [31mtotal : 0.335076 [94mAcc_combined: 87.68 [92mF1_combined: 80.08 [92mK_combined: 0.8292 [34mF1_perclass_combined: [92.04, 45.24, 87.86, 86.23, 89.02] 
[37mEpoch 12 step 349 with [31mtotal : 0.329928 [94mAcc_combined: 87.86 [92mF1_combined: 79.82 [92mK_combined: 0.8310 [34mF1_perclass_combined: [92.59, 43.74, 88.14, 85.68, 88.96] 
[37mEpoch 13 step 363 with [31mtotal : 0.329838 [94mAcc_combined: 87.79 [92mF1_combined: 80.48 [92mK_combined: 0.8311 [34mF1_perclass_combined: [92.29, 46.82, 87.92, 86.4, 89.0] 
[37mEpoch 13 step 367 with [31mtotal : 0.328491 [94mAcc_combined: 87.93 [92mF1_combined: 80.37 [92mK_combined: 0.8327 [34mF1_perclass_combined: [92.42, 45.84, 88.09, 86.37, 89.11] 
[37mEpoch 13 step 377 with [31mtotal : 0.328287 [94mAcc_combined: 87.95 [92mF1_combined: 80.13 [92mK_combined: 0.8331 [34mF1_perclass_combined: [92.52, 44.57, 88.12, 86.36, 89.07] 
[37mEpoch 13 step 378 with [31mtotal : 0.328188 [94mAcc_combined: 87.96 [92mF1_combined: 80.18 [92mK_combined: 0.8332 [34mF1_perclass_combined: [92.53, 44.84, 88.13, 86.32, 89.08] 
